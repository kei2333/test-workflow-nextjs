# 大型机连接超时优化

## 概述
为了支持连接时间特别长的大型机（超过2分钟），系统已经进行了全面的超时配置优化。

## 优化内容

### 1. Playwright 测试超时 (playwright.config.js)
- **总测试超时**: 从 2分钟 → **5分钟** (300秒)
- **expect 超时**: 从 10秒 → **30秒**
- 确保长时间运行的大型机测试不会被过早终止

### 2. 服务器启动超时 (scripts/run-tests-with-servers.js)
- **服务启动等待**: 从 2分钟 → **5分钟** (300秒)
- **健康检查间隔**: 从 2秒 → **3秒**
- 给服务器充足时间启动和就绪

### 3. s3270 连接超时 (backend/app.py)
- **连接超时**: 从 30秒 → **3分钟** (180秒)
- 同时适用于 TK5/Hercules 和标准系统（如 pub400）
- **连接建立等待**: 从 2秒 → **5秒**
- **屏幕获取超时**: 从 10秒/30秒 → **30秒/60秒**

### 4. 命令执行超时 (backend/app.py)
- **默认命令超时**: 从 10秒 → **30秒**
- **默认执行超时**: 从 10秒 → **30秒**
- 应对响应较慢的大型机命令

### 5. TSO 登录步骤优化 (backend/app.py)
- **TSO 命令响应**: 从 3秒 → **8秒**
- **用户名处理**: 从 3秒 → **8秒**
- **密码验证**: 从 3秒 → **10秒**
- **Enter 命令**: 从 2秒 → **5秒**
- **ISPF 加载**: 从 3秒 → **15秒**

## 兼容性

### 支持的连接时间
- ✅ **快速连接**: < 30秒
- ✅ **中等连接**: 30秒 - 2分钟  
- ✅ **慢速连接**: 2分钟 - 3分钟
- ✅ **极慢连接**: 3分钟+ (在合理范围内)

### 支持的系统类型
- **TK5/Hercules**: 本地测试环境
- **pub400.com**: 公共 IBM i 服务器
- **企业大型机**: 各种 IBM z/OS 和 IBM i 系统
- **网络条件差的远程系统**

## 使用方法

现有的测试命令无需更改：
```bash
npm run test:all          # 带界面的完整测试
npm run test:all:headless # 无界面的完整测试
```

系统会自动：
1. 等待足够时间让大型机建立连接
2. 给予充裕时间完成登录流程
3. 耐心等待命令响应
4. 处理网络延迟和系统负载

## 验证

运行以下命令检查配置：
```bash
node scripts/check-timeouts.js
```

这将显示所有超时设置的当前值，确认优化已正确应用。

## 注意事项

- 这些超时设置是保守的，确保兼容性优于速度
- 对于快速系统，测试仍然会尽快完成
- 只有在连接/响应真的很慢时才会使用完整的超时时间
- 如需要支持更极端的慢速连接，可以进一步调整这些值